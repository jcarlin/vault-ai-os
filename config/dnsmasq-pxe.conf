# PXE Boot Configuration for Vault Cube Deployment (Legacy BIOS)
#
# This file is a template. The setup-pxe-server.sh script generates a
# customized version with your actual paths and IP addresses.
#
# Usage:
#   sudo dnsmasq -d -C config/dnsmasq-pxe.conf
#
# NOTE: Only use this if you don't have an existing DHCP server on the network.
# If you have a router providing DHCP, use proxy mode instead (see below).

# =============================================================================
# Standard Mode (when YOU are the DHCP server)
# =============================================================================

# Network interface (change to match your setup)
# macOS: typically en0 (ethernet) or en1 (wifi)
# Linux: typically eth0, enp0s3, etc.
interface=en0

# DHCP range - adjust to your network
# Format: start-ip,end-ip,lease-time
# Example for 192.168.1.x network:
dhcp-range=192.168.1.200,192.168.1.250,12h

# Legacy BIOS PXE boot
# Tells clients to download pxelinux.0 from the TFTP server
dhcp-boot=pxelinux.0

# TFTP server settings
# The PXE clients download boot files from here
enable-tftp
tftp-root=/tmp/pxe-boot/tftpboot

# Logging (helpful for debugging)
log-dhcp
log-queries

# =============================================================================
# Proxy Mode (when ANOTHER device is the DHCP server)
# =============================================================================
# Use this configuration if you already have a DHCP server (router, etc.)
# providing IP addresses on the network.
#
# Proxy DHCP mode responds to PXE boot requests without interfering with
# your existing DHCP server.
#
# To use proxy mode:
# 1. Comment out the dhcp-range line above
# 2. Uncomment the two lines below
# 3. Adjust the IP range to match your network
#
# dhcp-range=192.168.1.0,proxy
# pxe-service=x86PC,"Install Vault Cube",pxelinux

# =============================================================================
# Alternative: Configure Your Existing DHCP Server
# =============================================================================
# Instead of running dnsmasq, you can configure your existing DHCP server
# (router, pfSense, Windows DHCP, etc.) to support PXE boot:
#
# Required DHCP options:
#   Option 66 (next-server): IP address of your Mac running TFTP
#   Option 67 (filename):    pxelinux.0
#
# Example for pfSense:
#   Services > DHCP Server > Other Options
#   Next Server: 192.168.1.x (your Mac's IP)
#   Default BIOS file name: pxelinux.0
#
# Example for ISC DHCP (Linux):
#   next-server 192.168.1.x;
#   filename "pxelinux.0";

# =============================================================================
# Troubleshooting
# =============================================================================
# 1. Firewall: Ensure ports are open:
#    - UDP 67 (DHCP server)
#    - UDP 68 (DHCP client)
#    - UDP 69 (TFTP)
#    - TCP 8080 (HTTP for image download)
#
# 2. macOS firewall:
#    System Preferences > Security & Privacy > Firewall > Firewall Options
#    Allow incoming connections for dnsmasq, python3
#
# 3. Test TFTP:
#    tftp YOUR_MAC_IP
#    get pxelinux.0
#    quit
#
# 4. Watch dnsmasq output for DHCP/TFTP requests
#    sudo dnsmasq -d -C config/dnsmasq-pxe.conf
#    (The -d flag runs in foreground with debug output)
