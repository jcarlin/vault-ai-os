---
# ansible/roles/nvidia/tasks/install_cudnn.yml
# Install cuDNN (CUDA Deep Neural Network library)

- name: Set cuDNN package variables
  set_fact:
    cudnn_major_version: "{{ cudnn_version.split('.')[0] }}"
    cuda_major_version: "{{ cuda_version.split('.')[0] }}"

- name: Install cuDNN
  apt:
    name:
      - "libcudnn{{ cudnn_major_version }}-cuda-{{ cuda_major_version }}"
      - "libcudnn{{ cudnn_major_version }}-dev-cuda-{{ cuda_major_version }}"
    state: present
  register: cudnn_installed
  failed_when: false

- name: Display cuDNN installation status
  debug:
    msg: "cuDNN {{ cudnn_version }} installed successfully"
  when: cudnn_installed.changed | default(false)

- name: Note if cuDNN installation failed
  debug:
    msg: "cuDNN installation skipped or failed. This is not critical for basic GPU operation."
  when: cudnn_installed.failed | default(false)
